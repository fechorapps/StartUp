<Project>  
  <!-- Target personalizado: Mostrar informaciÃ³n del build -->
  <Target Name="ShowBuildInfo" BeforeTargets="CoreCompile">
    <Message Importance="high" Text="================================================" />
    <Message Importance="high" Text="Building: $(MSBuildProjectName)" />
    <Message Importance="high" Text="Namespace: $(RootNamespace)" />
    <Message Importance="high" Text="Framework: $(TargetFramework)" />
    <Message Importance="high" Text="Configuration: $(Configuration)" />
    <Message Importance="high" Text="================================================" />
  </Target>

  <!-- Target personalizado: Validar estructura del proyecto -->
  <Target Name="ValidateProjectStructure" BeforeTargets="Build">
    <Message Importance="normal" Text="Validating project structure for $(MSBuildProjectName)..." />
  </Target>

  <!-- Target personalizado: Limpiar archivos generados -->
  <Target Name="CleanGenerated" AfterTargets="Clean">
    <ItemGroup>
      <GeneratedFiles Include="$(MSBuildProjectDirectory)\**\*.g.cs" />
      <GeneratedFiles Include="$(MSBuildProjectDirectory)\**\*.generated.cs" />
    </ItemGroup>
    <Delete Files="@(GeneratedFiles)" />
    <Message Importance="high" Text="Cleaned generated files for $(MSBuildProjectName)" />
  </Target>

  <!-- Target personalizado: Verificar dependencias de arquitectura -->
  <Target Name="ValidateArchitectureDependencies" BeforeTargets="Build" Condition="'$(Configuration)' == 'Release'">
    <Message Importance="normal" Text="Validating architecture dependencies..." />

    <!-- Domain no debe referenciar otros proyectos -->
    <Error Condition="'$(MSBuildProjectName)' == 'Domain' AND '$(ProjectReference)' != ''"
           Text="Domain layer should not have project references!" />

    <!-- Application solo puede referenciar Domain -->
    <Warning Condition="'$(MSBuildProjectName)' == 'Application'"
             Text="Ensure Application only references Domain layer" />
  </Target>

  <!-- Target personalizado: Copiar archivos de configuraciÃ³n en desarrollo -->
  <Target Name="CopyDevSettings" AfterTargets="Build" Condition="'$(Configuration)' == 'Debug' AND '$(MSBuildProjectName)' == 'API'">
    <Message Importance="high" Text="Development mode: Configuration files ready" />
  </Target>

  <!-- Target personalizado: Generar reporte de build -->
  <Target Name="GenerateBuildReport" AfterTargets="Build" Condition="'$(GenerateBuildReport)' == 'true'">
    <Message Importance="high" Text="Build completed successfully for $(MSBuildProjectName)" />
    <Message Importance="high" Text="Output: $(OutputPath)" />
    <Message Importance="high" Text="Assembly: $(TargetFileName)" />
  </Target>

  <!-- Target personalizado para verificar actualizaciones de paquetes -->
  <Target Name="CheckPackageUpdates">
    <Message Text="========================================" Importance="high" />
    <Message Text="ðŸ” Verificando actualizaciones de paquetes NuGet..." Importance="high" />
    <Message Text="========================================" Importance="high" />
    <Exec Command="dotnet list package --outdated"
          WorkingDirectory="$(SolutionDir)"
          IgnoreExitCode="true" />
    <Message Text="========================================" Importance="high" />
    <Message Text="âœ… VerificaciÃ³n completada" Importance="high" />
    <Message Text="========================================" Importance="high" />
  </Target>

  <!-- Target para verificar vulnerabilidades de seguridad -->
  <Target Name="CheckVulnerabilities">
    <Message Text="========================================" Importance="high" />
    <Message Text="ðŸ”’ Verificando vulnerabilidades de seguridad..." Importance="high" />
    <Message Text="========================================" Importance="high" />
    <Exec Command="dotnet list package --vulnerable --include-transitive"
          WorkingDirectory="$(SolutionDir)"
          IgnoreExitCode="true" />
    <Message Text="========================================" Importance="high" />
    <Message Text="âœ… VerificaciÃ³n de seguridad completada" Importance="high" />
    <Message Text="========================================" Importance="high" />
  </Target>

  <!-- Target para verificar paquetes deprecados -->
  <Target Name="CheckDeprecated">
    <Message Text="========================================" Importance="high" />
    <Message Text="âš ï¸  Verificando paquetes deprecados..." Importance="high" />
    <Message Text="========================================" Importance="high" />
    <Exec Command="dotnet list package --deprecated --include-transitive"
          WorkingDirectory="$(SolutionDir)"
          IgnoreExitCode="true" />
    <Message Text="========================================" Importance="high" />
    <Message Text="âœ… VerificaciÃ³n de deprecados completada" Importance="high" />
    <Message Text="========================================" Importance="high" />
  </Target>

  <!-- Target combinado para ejecutar todas las verificaciones -->
  <Target Name="CheckPackageHealth" DependsOnTargets="CheckPackageUpdates;CheckVulnerabilities;CheckDeprecated">
    <Message Text="" Importance="high" />
    <Message Text="========================================" Importance="high" />
    <Message Text="ðŸŽ‰ Todas las verificaciones completadas" Importance="high" />
    <Message Text="========================================" Importance="high" />
    <Message Text="" Importance="high" />
    <Message Text="Comandos disponibles:" Importance="high" />
    <Message Text="  dotnet build -t:CheckPackageUpdates     - Verificar actualizaciones" Importance="high" />
    <Message Text="  dotnet build -t:CheckVulnerabilities    - Verificar vulnerabilidades" Importance="high" />
    <Message Text="  dotnet build -t:CheckDeprecated         - Verificar paquetes deprecados" Importance="high" />
    <Message Text="  dotnet build -t:CheckPackageHealth      - Ejecutar todas las verificaciones" Importance="high" />
    <Message Text="========================================" Importance="high" />
  </Target>

</Project>
